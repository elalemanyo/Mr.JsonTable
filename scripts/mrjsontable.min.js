(function(a){a.fn.mrjsontablecolumn=function(b){return a.extend({},a.fn.mrjsontablecolumn.defaults,b)};a.fn.mrjsontablecolumn.defaults={heading:"Heading",data:"json_field",type:"string",sortable:!0,starthidden:!1};a.fn.mrjsontable=function(b){var c=this.selector,e=a.extend({},a.fn.mrjsontable.defaults,b);b=a("<div>",{"data-so":"A","data-ps":e.pageSize}).addClass("mrjt");var k=a("<div>").addClass("legend"),g=a("<table>").addClass(e.tableClass),h=a("<thead>"),l=a("<tr>");a.each(e.columns,function(b,
f){var d=a("<th>").attr("data-i",b);a("<input>",{type:"checkbox",id:"cb"+c+b,value:b,checked:!f.starthidden,"data-i":b}).bind("change",e.onHiddenCBChange).appendTo(k);a("<label />",{"for":"cb"+c+b,text:f.heading}).appendTo(k);f.starthidden&&d.hide();f.sortable?a("<a>",{"class":"s-init",href:"#","data-i":b,"data-t":f.type}).text(f.heading).bind("click",e.onSortClick).appendTo(d):a("<span>").text(f.heading).appendTo(d);d.appendTo(l)});l.appendTo(h);h.appendTo(g);var m=!1;a.each(e.data,function(b,c){var d=
a("<tr>").attr("data-i",b);e.pageSize<=b&&(d.hide(),m=!0);a.each(e.columns,function(b,e){var g=a("<td>").html(c[e.data]).attr("data-i",b);e.starthidden&&g.hide();g.appendTo(d)});d.appendTo(g)});b.append(k);b.append(g);if(m){for(var h=a("<div>").addClass("paging"),d=0;d<Math.ceil(e.data.length/e.pageSize);d++)a("<a>",{text:"Page "+(d+1),href:"#","data-i":d+1,"class":"p-link"}).bind("click",e.onPageClick).appendTo(h);b.append(h).addClass("paged")}return this.append(b)};a.fn.mrjsontable.defaults={cssClass:"table",
columns:[],data:[],pageSize:10,onHiddenCBChange:function(){var b=a(this).parents(".mrjt"),c=a(this).attr("data-i");a(this).is(":checked")?(a("td[data-i='"+c+"']",b).show(),a("th[data-i='"+c+"']",b).show()):(a("td[data-i='"+c+"']",b).hide(),a("th[data-i='"+c+"']",b).hide())},onPageClick:function(){var b=a(this).parents(".mrjt"),c=b.attr("data-ps"),e=a(this).attr("data-i");a("tbody tr",b).each(function(b,g){a(this).hide();var h=e*c;b+1>=(e-1)*c+1&&b+1<=h&&a(this).show()});return!1},onSortClick:function(){var b=
a(this).parents(".mrjt"),c=b.attr("data-so");a(".s-init",b).removeClass("s-A s-D");a(this).addClass("s-"+c);var e=a(this).attr("data-t"),k=a(this).attr("data-i"),g=[];a("tbody tr",b).each(function(b,c){var d=a("td",c).eq(k),h=d.parent().attr("data-i"),f=null;switch(e){case "string":f=d.text();break;case "int":f=parseInt(d.text());break;case "float":f=parseFloat(d.text());break;case "datetime":f=new Date(d.text());break;default:f=d.text()}g.push({tr_id:h,val:f})});"A"==c?(g.sort(function(a,b){return a.val>
b.val?1:a.val<b.val?-1:0}),b.attr("data-so","D")):(g.sort(function(a,b){return a.val<b.val?1:a.val>b.val?-1:0}),b.attr("data-so","A"));for(c=0;c<g.length;c++){var h=a("tr[data-i='"+g[c].tr_id+"']",b);h.detach();a("tbody",b).append(h)}b.hasClass("paged")&&a(".p-link",b).eq(0).click();return!1}}})(jQuery);
